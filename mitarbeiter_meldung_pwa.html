<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mitarbeiter Meldung</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .hidden { display: none; }
    #app { text-align: center; }
    input {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
      width: 220px;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #krank { background: #d9534f; color: white; }
    #anwesend { background: #5cb85c; color: white; }
  </style>
</head>
<body>
  <div id="login">
    <h2>Passwort eingeben</h2>
    <input type="password" id="password" placeholder="Passwort" />
    <button onclick="checkPassword()">Weiter</button>
  </div>

  <div id="setup" class="hidden">
    <h2>Vorname und Nachname eingeben</h2>
    <input type="text" id="vorname" placeholder="Vorname" />
    <input type="text" id="nachname" placeholder="Nachname" />
    <button onclick="saveName()">Speichern</button>
  </div>

  <div id="app" class="hidden">
    <h2>Meldung senden</h2>
    <button id="krank" onclick="sendMail('krank')">Krank melden</button>
    <button id="anwesend" onclick="sendMail('anwesend')">BIN DA melden</button>
  </div>

  <script>
    const correctPassword = "53.3";
    const storagePasswordKey = "pwSet";
    const storageVornameKey = "vorname";
    const storageNachnameKey = "nachname";

    window.onload = () => {
      if (localStorage.getItem(storagePasswordKey) === "true") {
        if (localStorage.getItem(storageVornameKey) && localStorage.getItem(storageNachnameKey)) {
          showApp();
        } else {
          showSetup();
        }
      } else {
        showLogin();
      }
    };

    function showLogin() {
      document.getElementById("login").classList.remove("hidden");
      document.getElementById("setup").classList.add("hidden");
      document.getElementById("app").classList.add("hidden");
    }

    function showSetup() {
      document.getElementById("login").classList.add("hidden");
      document.getElementById("setup").classList.remove("hidden");
      document.getElementById("app").classList.add("hidden");
    }

    function showApp() {
      document.getElementById("login").classList.add("hidden");
      document.getElementById("setup").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
    }

    function checkPassword() {
      const pw = document.getElementById("password").value;
      if (pw === correctPassword) {
        localStorage.setItem(storagePasswordKey, "true");
        if (localStorage.getItem(storageVornameKey) && localStorage.getItem(storageNachnameKey)) {
          showApp();
        } else {
          showSetup();
        }
      } else {
        alert("Falsches Passwort");
      }
    }

    function saveName() {
      const vorname = document.getElementById("vorname").value.trim();
      const nachname = document.getElementById("nachname").value.trim();
      if (vorname && nachname) {
        localStorage.setItem(storageVornameKey, vorname);
        localStorage.setItem(storageNachnameKey, nachname);
        showApp();
      } else {
        alert("Bitte Vorname und Nachname eingeben");
      }
    }

    function sendMail(type) {
      const vorname = localStorage.getItem(storageVornameKey);
      const nachname = localStorage.getItem(storageNachnameKey);
      const email = "kjgd@minden-luebbecke.de";
      let subject = "";
      let body = "";

      if (type === "krank") {
        subject = `Krankmeldung – ${vorname} ${nachname}`;
        body = `Sehr geehrte Damen und Herren,\\n\\nHiermit melde ich mich krank.\\n\\n${vorname} ${nachname}`;
      } else {
        subject = `BIN DA – ${vorname} ${nachname}`;
        body = `Sehr geehrte Damen und Herren,\\n\\nIch bin heute anwesend.\\n\\n${vorname} ${nachname}`;
      }

      window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }
  </script>
</body>
</html>
